#encoding:utf-8
#==============================================================================
# ■ Lctseng::Spriteset_MiniMenu
#------------------------------------------------------------------------------
#     處理選單系統的精靈組
#==============================================================================
module Lctseng
class Spriteset_MiniMenu
  #--------------------------------------------------------------------------
  # ● 加入設定模組
  #--------------------------------------------------------------------------
  #--------------------------------------------------------------------------
  # ● 等待用方法
  #--------------------------------------------------------------------------
  #--------------------------------------------------------------------------
  # ● 初始化對象
  #--------------------------------------------------------------------------
  def initialize(viewport)
    @viewport = viewport
    create_spritesets
  end
  #--------------------------------------------------------------------------
  # ● 產生精靈組
  #--------------------------------------------------------------------------
  def create_spritesets
    # 選單按鈕
    @base = Sprite_MiniMenuButton.new(:base,[453,14],'MiniMenu',@viewport)
    # 小選單
    @mini = Sprite_MiniMenu.new(@viewport)
    @sprites = [@base,@mini]
  end
  #--------------------------------------------------------------------------
  # ● 釋放
  #--------------------------------------------------------------------------
  def dispose
    dispose_spritesets
  end
  #--------------------------------------------------------------------------
  # ● 釋放精靈組
  #--------------------------------------------------------------------------
  def dispose_spritesets
    @base.dispose
    @mini.dispose
  end
  #--------------------------------------------------------------------------
  # ● 更新
  #--------------------------------------------------------------------------
  def update
    update_spritesets
    update_input 
  end
  #--------------------------------------------------------------------------
  # ● 更新精靈組
  #--------------------------------------------------------------------------
  def update_spritesets
    @base.update
    @mini.update
  end
  #--------------------------------------------------------------------------
  # ● 更新輸入
  #--------------------------------------------------------------------------
  def update_input
    if Input.trigger?(:B) && @mini.open?
      Sound.play_cancel
      @base.process_ok
      close_mini
    end
    if Input.trigger?(:C)
      puts "已觸發確認鍵"     
      @sprites.each do |s|
        if s.on 
          if s.check_command_availble
            s.process_ok
            Sound.play_ok
            process_command(s.symbol)
          else
            Sound.play_buzzer
          end
        end
      end
    end
  end
  #--------------------------------------------------------------------------
  # ● 處理指令
  #--------------------------------------------------------------------------
  def process_command(sym)
    case sym
    when :base
      if @base.selected
        open_mini
      else
        close_mini
      end
    when :save
      SceneManager.call(Scene_Save)
    when :load
      SceneManager.call(Scene_Load)
    when :home
      SceneManager.goto(Scene_Title)
    when :exit
      SceneManager.exit
    end
  end
  #--------------------------------------------------------------------------
  # ● 開啟小選單
  #--------------------------------------------------------------------------
  def open_mini
    @mini.open
  end
  #--------------------------------------------------------------------------
  # ● 關閉小選單
  #--------------------------------------------------------------------------
  def close_mini
    @mini.close
  end

  
end
end