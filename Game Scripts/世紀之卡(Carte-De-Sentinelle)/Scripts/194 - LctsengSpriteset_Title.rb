#encoding:utf-8
#==============================================================================
# ■ Lctseng::Spriteset_Title
#------------------------------------------------------------------------------
#     處理選單系統的精靈組
#==============================================================================
module Lctseng
class Spriteset_Title
  #--------------------------------------------------------------------------
  # ● 加入設定模組
  #--------------------------------------------------------------------------
  include Lctseng::TitleSettings

  #--------------------------------------------------------------------------
  # ● 等待用方法
  #--------------------------------------------------------------------------
  attr_accessor :wait_method
  attr_accessor :command_method
  #--------------------------------------------------------------------------
  # ● 初始化對象
  #--------------------------------------------------------------------------
  def initialize
    create_viewports
    create_spritesets
  end
  #--------------------------------------------------------------------------
  # ● 產生顯示端口
  #--------------------------------------------------------------------------
  def create_viewports
    # 背景框架
    @viewport_base = Viewport.new
    # 資訊框架(Z = 10)
    @viewport_info = Viewport.new
    @viewport_info.z = 10
  end
  #--------------------------------------------------------------------------
  # ● 產生精靈組
  #--------------------------------------------------------------------------
  def create_spritesets
    # 背景
    @base = Sprite.new(@viewport_base)
    @base.bitmap = Cache.title("background")
    # 指令
    @cmds = []
    [:start,:load,:credit,:exit].each_with_index do |sym,index|
      @cmds.push(Sprite_TitleCommand.new(index,sym,@viewport_info))
    end

  end
  #--------------------------------------------------------------------------
  # ● 釋放
  #--------------------------------------------------------------------------
  def dispose
    dispose_spritesets
    dispose_viewports
  end
  #--------------------------------------------------------------------------
  # ● 釋放精靈組
  #--------------------------------------------------------------------------
  def dispose_spritesets
    @cmds.each {|s| s.dispose}
    @base.dispose
  end
  #--------------------------------------------------------------------------
  # ● 釋放顯示端口
  #--------------------------------------------------------------------------
  def dispose_viewports
    @viewport_base.dispose
    @viewport_info.dispose
  end
  #--------------------------------------------------------------------------
  # ● 更新
  #--------------------------------------------------------------------------
  def update
    update_spritesets
    update_input 
  end
  #--------------------------------------------------------------------------
  # ● 更新精靈組
  #--------------------------------------------------------------------------
  def update_spritesets
    @cmds.each {|s| s.update}
  end
  #--------------------------------------------------------------------------
  # ● 更新輸入
  #--------------------------------------------------------------------------
  def update_input
    if Input.trigger?(:C)
      puts "已觸發確認鍵"
      @cmds.each do |s|
        if s.on 
          if s.check_command_availble
            s.process_ok
            Sound.play_ok
            command_method.call(s.symbol)
          else
            Sound.play_buzzer
          end
        end
        
      end
    end
  end
  #--------------------------------------------------------------------------
  # ● 等待效果
  #--------------------------------------------------------------------------
  def wait_for_effect
    if @wait_method
      @wait_method.call
    end
  end
  #--------------------------------------------------------------------------
  # ● 是否需等待效果
  #--------------------------------------------------------------------------
  def wait_effect?
    false
  end

end
end