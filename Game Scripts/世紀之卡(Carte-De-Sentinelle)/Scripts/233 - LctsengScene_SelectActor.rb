#encoding:utf-8
#==============================================================================
# ■ Lctseng::Scene_SelectActor
#------------------------------------------------------------------------------
# 　選角色畫面
#==============================================================================

module Lctseng
class Scene_SelectActor < Scene_Base
  #--------------------------------------------------------------------------
  # ● 設置清除rollback的處理程序
  #--------------------------------------------------------------------------
  def self.set_clear_rollback(proc)
    @@clear_handler = proc
  end
  #--------------------------------------------------------------------------
  # ● 清除BGM設置
  #--------------------------------------------------------------------------
  def self.clear_bgm_set
    @@bgm_set = false
  end
  #--------------------------------------------------------------------------
  # ● 取得rollback的處理程序
  #--------------------------------------------------------------------------
  def self.rollback_handler
    @@clear_handler
  end
  #--------------------------------------------------------------------------
  # ● 開始處理
  #--------------------------------------------------------------------------
  def start
    super
    create_spriteset
    if !@@bgm_set
      @@bgm_set = true
      RPG::BGM.new("Battle4").play
    end
    
  end

  #--------------------------------------------------------------------------
  # ● 準備存檔資訊
  #--------------------------------------------------------------------------
  def prepare_save_file
    if DataManager.save_bitmap.nil? or DataManager.save_bitmap.disposed?
      DataManager.snapshot_for_save
      #DataManager.save_game(0)
    end
  end
  #--------------------------------------------------------------------------
  # ● 開始后處理 - 重新定義
  #--------------------------------------------------------------------------
  def post_start
    perform_transition
    prepare_save_file
    Input.update
  end
  #--------------------------------------------------------------------------
  # ● 產生精靈組
  #--------------------------------------------------------------------------
  def create_spriteset
    @spriteset = Spriteset_SelectActor.new(method(:command_caller))
  end
  #--------------------------------------------------------------------------
  # ● 結束處理
  #--------------------------------------------------------------------------
  def terminate
    super
    dispose_spriteset
  end
  #--------------------------------------------------------------------------
  # ● 釋放精靈組
  #--------------------------------------------------------------------------
  def dispose_spriteset
    @spriteset.dispose
  end
  #--------------------------------------------------------------------------
  # ● 更新 (基礎)
  #--------------------------------------------------------------------------
  def update_basic
    super
    @spriteset.update
  end
  #--------------------------------------------------------------------------
  # ● 呼叫存檔
  #--------------------------------------------------------------------------
  def call_save
    DataManager.snapshot_for_save
    SceneManager.call(Scene_Save)
  end
  #--------------------------------------------------------------------------
  # ● 指令呼叫
  #--------------------------------------------------------------------------
  def command_caller(id)
    if id < 0
      call_save
    else
      puts "選擇角色：#{id}"
      $game_variables[CardBattle::VARIABLE_ACTOR] = id
      @@clear_handler.call
      SceneManager.goto(Scene_SelectMode)
    end
  end
  

end
end